# === LEVQOR BACKEND â€” BEGINNER DEPLOYMENT GUIDE (ONE-PROMPT VERSION) ===

# STEP 1 â€” DEPLOY BACKEND ON REPLIT
# 1. Open your Replit project "levqor-backend"
# 2. Go to Deployments â†’ Create or Configure Deployment
# 3. Set start command:
gunicorn --workers 2 --threads 4 --timeout 30 --bind 0.0.0.0:$PORT --reuse-port --log-level info run:app
# 4. Set health check path: /
# 5. Add environment variables:
# (Replace <your_key_here> with your real API key)
API_KEYS=<your_key_here>
BUILD_ID=2025-11-05.1
# 6. Click "Publish" and wait until the green check appears.

# STEP 2 â€” CONNECT YOUR DOMAIN
# Go to your DNS provider and add:
CNAME  api   â†’   <your-repl-name>.repl.co
# Save and wait 15â€“30 minutes for DNS propagation.

# STEP 3 â€” VERIFY BACKEND LIVE
# Replace <your-repl-name> or use api.levqor.ai once DNS is ready:
curl -s https://<your-repl-name>.repl.co/ | jq
curl -s https://<your-repl-name>.repl.co/public/metrics | jq
# Expected: JSON responses with "ok": true and uptime metrics.

# STEP 4 â€” SUBMIT TEST JOB
KEY=<your_key_here>
jid=$(curl -s -X POST https://api.levqor.ai/api/v1/intake \
 -H "X-Api-Key: $KEY" -H "Content-Type: application/json" \
 -d '{"workflow":"demo","payload":{}}' | jq -r .job_id)
curl -s https://api.levqor.ai/api/v1/status/$jid | jq

# STEP 5 â€” DEPLOY FRONTEND ON VERCEL
# 1. Push your "frontend" folder to GitHub.
# 2. Go to vercel.com â†’ New Project â†’ Import from GitHub.
# 3. Add environment variable:
VITE_API_URL=https://api.levqor.ai
# 4. Click Deploy.
# 5. Open your Vercel link (should load Levqor landing page).

# STEP 6 â€” POINT MAIN DOMAIN
# Add these DNS records:
A     levqor.ai  â†’  76.76.21.21
CNAME www        â†’  cname.vercel-dns.com
# Wait until Vercel verifies the domain.

# STEP 7 â€” MONITORING & BACKUPS
# Add free monitor:
# uptime robot â†’ new HTTPS monitor â†’ https://api.levqor.ai/health
# Run first backup in Replit shell:
./scripts/backup_db.sh
ls backups/

# STEP 8 â€” CHECK EVERYTHING WORKS
# 1. Visit https://api.levqor.ai/ â†’ should return JSON with service/version.
# 2. Visit https://api.levqor.ai/public/metrics â†’ shows metrics.
# 3. Submit and check a test job (as above).
# 4. Visit frontend â†’ status card updates.
# 5. Confirm UptimeRobot shows "UP" and green.

# STEP 9 â€” AFTER LAUNCH
# - Keep Stripe in TEST mode until ready.
# - Add ICO number to Privacy Policy when registered.
# - Rotate API keys monthly:
#   add API_KEYS_NEXT=<new_key>, redeploy, update clients, then remove old.
# - Continue running backups daily.

# STEP 10 â€” QUICK SMOKE TEST (FULL AUTOMATION)
KEY=<your_key_here>
set -e
curl -sI https://api.levqor.ai/ | head -n1
curl -sI https://api.levqor.ai/public/metrics | grep -E 'Strict-Transport|Content-Security-Policy|X-Frame-Options'
jid=$(curl -s -X POST https://api.levqor.ai/api/v1/intake \
 -H "X-Api-Key: $KEY" -H "Content-Type: application/json" \
 -d '{"workflow":"demo","payload":{}}' | jq -r .job_id)
curl -s https://api.levqor.ai/api/v1/status/$jid | jq
echo "ðŸŸ¢ COCKPIT GREEN â€” Levqor backend live and operational."

# === END OF PROMPT ===