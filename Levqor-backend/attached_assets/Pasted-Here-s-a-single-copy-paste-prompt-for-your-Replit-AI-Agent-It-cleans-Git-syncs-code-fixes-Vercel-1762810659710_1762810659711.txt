Here’s a single, copy-paste prompt for your Replit AI Agent. It cleans Git, syncs code, fixes Vercel envs, checks the Stripe checkout route, and triggers one clean deploy when the Vercel limit resets. It is idempotent and safe.


---

AI Agent Prompt — “Levqor: Fix → Sync → Deploy”

Goal: Repair Stripe checkout, fix Vercel production env, push clean code, deploy once the Vercel quota resets, then verify /, /pricing, and /api/checkout.

Do exactly this, in order:

1. Preflight



Repo root: ~/workspace/levqor-site (frontend) and project root for any backend files.

Abort on error. Echo each step.


2. Git: unlock, sanitize, sync



Run:

cd ~/workspace/levqor-site || exit 1

rm -f .git/index.lock

Ensure a strict .gitignore includes:
.env*, .next, node_modules, .vercel, __pycache__, *.log, backups/, *.sqlite, *.db, secret.*

If not present, append those lines to .gitignore.

Unstage any secrets or artifacts:
git restore --staged .env* .next node_modules __pycache__ *.log backups/ *.sqlite *.db secret.* 2>/dev/null || true

git status --short

Stage only source and scripts:
git add src/ scripts/ package.json package-lock.json next.config.* tsconfig.* README*

Commit if changes exist:
git diff --cached --quiet || git commit -m "sync: pricing + checkout fixes, no secrets"

Push: git push origin main || true



3. Vercel auth + project sanity



Require env var VERCEL_TOKEN. If missing, print:
Missing VERCEL_TOKEN. Add it to Replit Secrets, then re-run.

Confirm project linkage:
npx vercel --version >/dev/null 2>&1 || npm i -g vercel
vercel projects ls --token "$VERCEL_TOKEN" | grep -i "levqor"
If not linked, print instructions to link and stop.


4. Stripe + Vercel Production env check and repair



Verify these Production envs exist and are non-empty. If any is missing/empty, set it using vercel env add with value read from current Production value or from our ops/stripe_prices.json if present. Keys:

STRIPE_SECRET_KEY

STRIPE_WEBHOOK_SECRET

SITE_URL = https://levqor.ai

NEXT_PUBLIC_API_URL = https://api.levqor.ai

FREE_TRIAL_DAYS = 7

Plan prices:
STRIPE_PRICE_STARTER, STRIPE_PRICE_STARTER_YEAR,
STRIPE_PRICE_PRO, STRIPE_PRICE_PRO_YEAR,
STRIPE_PRICE_BUSINESS, STRIPE_PRICE_BUSINESS_YEAR

Add-ons (enterprise):
STRIPE_PRICE_ADDON_PRIORITY_SUPPORT,
STRIPE_PRICE_ADDON_SLA_99_9,
STRIPE_PRICE_ADDON_WHITE_LABEL


Use:
vercel env ls --token "$VERCEL_TOKEN" to inspect, and
vercel env add KEY production --token "$VERCEL_TOKEN" to create any missing keys.
If a key exists but is wrong, print a warning and add a note for manual correction. Do not delete existing keys.


5. Checkout API integrity check (no code changes unless missing)



File must exist: src/app/api/checkout/route.ts.

It must support:

POST JSON {plan, term, addons?} returning {url: "<Stripe Checkout URL>"}.

GET diagnostic returning JSON health info (no secrets).

Static env references (no process.env[key] dynamic indexing).


If missing, create the minimal working route with:

Lazy Stripe init inside handler.

Plans: starter/pro/business × monthly/yearly.

Add-ons: PRIORITY_SUPPORT, SLA_99_9, WHITE_LABEL.

Use STRIPE_SECRET_KEY and the exact env var names listed above.


After creating or editing, run:
git add src/app/api/checkout/route.ts && git commit -m "feat(checkout): robust POST + GET, static env map" || true
git push origin main || true


6. Vercel deploy guard



Check current deploy quota and recent failures:
vercel deployments --token "$VERCEL_TOKEN" | head -n 50

If “Daily deployment limit reached” appears, print only:
Quota reached. Preflight complete. Try deploy again after reset.
Exit successfully (0) so the user can re-run later without breaking state.


7. Trigger one clean production deploy



If quota allows:
vercel --prod --force --token "$VERCEL_TOKEN" || exit 1


8. Post-deploy verification



Wait 150s for propagation. Then:

curl -I https://levqor.ai | head -n 1

curl -I https://levqor.ai/pricing | head -n 1

curl -s -X POST https://levqor.ai/api/checkout -H 'content-type: application/json' --data '{"plan":"starter","term":"monthly"}'

Expect JSON with url key or HTTP 303. If not, print concise diagnostics:

Missing envs? Show vercel env ls --token "$VERCEL_TOKEN" | grep STRIPE_

Serverless error? Suggest checking Vercel Logs for the function




9. If launch confirmed



If homepage shows “Public Beta” and /pricing is linked from root, print a single reminder to run the AFTER-LAUNCH checklist with these quick links:

Backend /status: https://api.levqor.ai/status

Backend /ops/uptime: https://api.levqor.ai/ops/uptime

GitHub Actions: your repo actions URL

Stripe Dashboard

Resend Dashboard



End of prompt.


---

Use this as is. It will:

Clean and push only source files.

Validate and repair Production envs in Vercel.

Avoid dynamic env lookups in Next.js.

Deploy once the quota allows.

Verify checkout returns a Stripe URL.