# === ADD POST-DEPLOY CHECKLIST TO DASHBOARD ===
cat >> dashboard.html <<'EOF'

<!-- ==================== POST-DEPLOY CHECKLIST (Phase 30) ==================== -->
<section id="post-deploy" class="mt-6 p-4 rounded-2xl bg-gray-900 text-gray-200 shadow-lg border border-gray-800">
  <h2 class="text-xl font-bold mb-3">ğŸ§¾ Post-Deploy Checklist</h2>
  <p class="text-sm mb-4 text-gray-400">Quick health verification after deployment.</p>
  <div id="checklist">
    <label class="block my-1"><input type="checkbox" id="chkScheduler"> âœ… Scheduler running (PID active)</label>
    <label class="block my-1"><input type="checkbox" id="chkTicks"> âœ… Heartbeat ticks < 60s apart</label>
    <label class="block my-1"><input type="checkbox" id="chkBrief"> âœ… Latest CEO Brief generated</label>
    <label class="block my-1"><input type="checkbox" id="chkSelfheal"> âœ… Self-Heal operational</label>
    <label class="block my-1"><input type="checkbox" id="chkLogs"> âœ… Logs available (scheduler.log)</label>
  </div>

  <button class="mt-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg shadow" onclick="runChecklist()">â–¶ Run Checklist</button>
  <p id="checkResult" class="mt-3 text-sm text-gray-400"></p>

  <div class="mt-4 text-sm">
    <a href="/logs/scheduler.log" class="underline text-blue-400">View scheduler.log</a> |
    <a href="/logs/PHASE30_COMPLETE.txt" class="underline text-blue-400">Phase 30 summary</a>
  </div>
</section>

<script>
async function runChecklist() {
  const dashKey = localStorage.getItem('dashKey');
  const result = document.getElementById('checkResult');
  result.innerText = 'Running checks...';

  try {
    const res = await fetch('/api/automations/status', {
      headers: { 'X-Dash-Key': dashKey }
    });
    const data = await res.json();

    const running = data?.data?.running;
    const pid = data?.data?.pid;
    document.getElementById('chkScheduler').checked = running === true;

    // Check tick activity
    const tickRes = await fetch('/logs/scheduler.log');
    const text = await tickRes.text();
    const tickCount = (text.match(/"event": "tick"/g) || []).length;
    document.getElementById('chkTicks').checked = tickCount > 0;

    // Check CEO Brief
    const briefOK = text.includes('exec_briefs');
    document.getElementById('chkBrief').checked = briefOK;

    // Check Self-Heal indicator
    const selfhealOK = text.includes('self_heal');
    document.getElementById('chkSelfheal').checked = selfhealOK;

    // Check log presence
    document.getElementById('chkLogs').checked = text.length > 200;

    result.innerText = running
      ? `âœ… Scheduler PID ${pid} active. ${tickCount} ticks logged.`
      : 'âš ï¸ Scheduler not active â€” start it from â€œâš™ï¸ Automations (Scheduler)â€';

  } catch (e) {
    result.innerText = 'âŒ Error: ' + e.message;
  }
}
</script>
<!-- ==================== END POST-DEPLOY CHECKLIST ==================== -->

EOF