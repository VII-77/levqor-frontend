Here‚Äôs your single-paste prompt for Phase 29 ‚Äì AI Executive Mode. Drop this into Replit AI exactly as-is:


---

OPEN MY Echopilotai REPLIT AND IMPLEMENT PHASE 29 (AI EXECUTIVE MODE) IN ONE GO:

Goals

Add GPT-driven anomaly detection + a concise daily ‚ÄúCEO Brief‚Äù.

Zero secrets in frontend, server-side only, protected by DASHBOARD_KEY.

Use existing model: gpt-4o-mini via AI_INTEGRATIONS_OPENAI_API_KEY (+ AI_INTEGRATIONS_OPENAI_BASE_URL if present).


1) Backend ‚Äì New secure endpoints (edit run.py) Create these routes, all returning uniform JSON {"ok":bool,"data":{...},"error":str|null} and protected by the same dashboard auth you added earlier:

GET /api/exec/report-latest
Returns the most recent brief from logs/exec_briefs/*.json if present.

POST /api/exec/ingest
Aggregates fresh signals into a single payload object:

Pull recent JSON/NDJSON from:

logs/daily_report_*.json (latest only)

logs/self_heal.log (last 200 lines)

logs/alerts.log (last 200 lines)

logs/e2e_validation.json (last 50 lines)

logs/release_captain.json (last 50 lines)

logs/health.ndjson (last 200 lines)


Call existing internal endpoints for live metrics:

/api/finance-metrics

/api/metrics-summary


Optional: If available, include last 10 Job Log items (via your Notion wrapper‚Äîhandle failures gracefully).
Save the raw ingestion snapshot to logs/exec_ingest_<ts>.json and return it.


POST /api/exec/analyze
Accepts the ingestion payload (or loads latest).
Run GPT-4o-mini with a system prompt that flags anomalies and produces an action plan. Required detection rules:

Quality: 3+ jobs in a row with QA < 80, or 7-day avg QA < target.

Finance: 7d ROI < 1.0, margin < 40%, revenue trend ‚Üì 3 days, unpaid jobs with QA ‚â• 95 older than 48h.

Ops: processing latency > 2 polling cycles, repeated Notion read-after-write lag > 90s, 5xx spikes, health endpoint timeouts.

Growth: sign-ups flat 7 days, referrals missing, email bounces.
Output strict JSON saved to logs/exec_analysis_<ts>.json:


{
  "kpis": {"jobs_7d":0,"revenue_7d":0,"avg_qa_7d":0,"roi_7d":0,"margin_pct_7d":0},
  "anomalies": [{"type":"finance|ops|quality|growth","severity":"low|med|high","signal":"<short>","evidence":["..."],"suggested_fix":"<1-liner>"}],
  "actions": [{"owner":"ops|eng|growth|finance","priority":1,"task":"<do this>","eta_hours":2}],
  "notes":["short bullets"],
  "confidence": 0.0
}

POST /api/exec/brief
Combines ingest + analyze into a human-readable brief + machine JSON:

Produce EXEC_BRIEF object:

{
  "ts": "<iso>",
  "headline": "<one-liner status>",
  "summary": "<5-8 line concise brief>",
  "kpis": {...},
  "top_risks": [...],
  "actions_next_24h": [...],
  "actions_next_7d": [...],
  "confidence": 0.0,
  "attachments": {
    "analysis_json_path": "logs/exec_analysis_<ts>.json",
    "ingest_json_path": "logs/exec_ingest_<ts>.json"
  }
}

Save to logs/exec_briefs/brief_<ts>.json.

Also render an HTML version with a simple KPI band + risks + actions (see templates below) and save to logs/exec_briefs/brief_<ts>.html.
Return both paths.


POST /api/exec/email
Sends latest brief via SMTP if SMTP_* secrets exist; otherwise logs to logs/exec_emails.log.

Use template templates/email_ceo_brief.html (create it).

To: ALERT_TO (already in secrets).

Subject: EchoPilot CEO Brief ‚Äî <DATE>.
Return "sent": true|false and where it was logged.


POST /api/exec/schedule-daily
Spawns a detached subprocess to run scripts/exec_brief.sh immediately and then exits (script handles scheduling via cron comments for users, but here just run once). Return status.


2) Model usage

Use existing OpenAI integration; model gpt-4o-mini only.

Temperature: 0.2.

Hard cap tokens via your existing cost guardrails; never exceed your current per-job cap.


3) Email template Create templates/email_ceo_brief.html (clean, responsive, inline styles) that renders:

Headline, KPI row (Jobs 7d, Revenue 7d, Avg QA 7d, ROI 7d, Margin 7d)

Top Risks (severity badges)

Next 24h / Next 7d actions (bullet list)

Footer with ‚ÄúGenerated by AI Executive Mode ¬∑ correlation: analysis JSON path‚Äù.


4) Script Create scripts/exec_brief.sh (executable) that:

#!/usr/bin/env bash
set -euo pipefail
BASE_URL="${1:-http://localhost:5000}"
HDR="X-Dash-Key: ${DASHBOARD_KEY}"
curl -s -H "$HDR" -X POST "$BASE_URL/api/exec/ingest" >/dev/null
curl -s -H "$HDR" -X POST "$BASE_URL/api/exec/brief"  | jq .
curl -s -H "$HDR" -X POST "$BASE_URL/api/exec/email" | jq .

5) Dashboard UI (dashboard.html) Add a new ‚Äúüëî CEO Brief‚Äù card (below Metrics Visualization):

Buttons (all send X-Dash-Key):

Ingest Now ‚Üí POST /api/exec/ingest

Generate Brief ‚Üí POST /api/exec/brief (prints saved file paths)

Email Brief ‚Üí POST /api/exec/email

Last Brief ‚Üí GET /api/exec/report-latest (render summary to the log area)


Keep existing auth; no secrets in frontend.


6) Logging

Create folder logs/exec_briefs/ if missing.

Append NDJSON entries to logs/exec_mode.log for each action (ingest/analyze/brief/email), with ts, actor:"exec_mode", event, ok, paths.


7) Security & limits

All /api/exec/* routes must require DASHBOARD_KEY and reuse the POST CSRF/rate limits you already added for ops routes.

Timeouts: each route ‚â§ 30s; stream large file reads safely; fail soft with warnings.


8) Tests (run automatically and show results) After implementation, execute and show outputs (use localhost base if needed):

# 1) Ingest
curl -s -H "X-Dash-Key: $DASHBOARD_KEY" -X POST https://echopilotai.replit.app/api/exec/ingest | jq .
# 2) Analyze (invoked inside brief)
curl -s -H "X-Dash-Key: $DASHBOARD_KEY" -X POST https://echopilotai.replit.app/api/exec/brief | jq .
# 3) Email (SMTP or log fallback)
curl -s -H "X-Dash-Key: $DASHBOARD_KEY" -X POST https://echopilotai.replit.app/api/exec/email | jq .
# 4) Read latest
curl -s -H "X-Dash-Key: $DASHBOARD_KEY" https://echopilotai.replit.app/api/exec/report-latest | jq .

9) Deliverables to show me

Exact files created/edited with line counts.

Sample EXEC_BRIEF JSON and saved HTML path.

Proof the dashboard buttons work (paste responses).

Where logs were written.


10) Commit Commit all with message:
Phase 29: AI Executive Mode (ingest‚Üíanalyze‚Üíbrief‚Üíemail) + dashboard card + logs

**Do not break existing routes or Stripe. Keep everything backwards compatible.**

