Open my Echopilotai Replit and implement Phase 26 in one go:

ğŸ¯ OBJECTIVE:
Upgrade the customer portal to provide a complete post-payment experience â€” email notifications, downloadable results, job history, and admin tools â€” without enabling live Stripe yet.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1ï¸âƒ£  FILES TO CREATE / UPDATE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A. portal.html  
   - Add new â€œDownload Resultsâ€ button (visible when Payment Status = Paid).  
   - Add new â€œJob Historyâ€ section listing the customerâ€™s last 5 jobs (QA score, cost, status).  
   - Add new â€œSubscribe for Updatesâ€ checkbox â†’ triggers email notifications.  
   - Add â€œHelp / Supportâ€ link that opens a small contact form (name + message).

B. run.py (+ ~300 lines)
   Add / confirm the following endpoints:

   âœ… /api/public/create-job (already exists â€” no change)  
   âœ… /api/public/job-status/<cid> (add returned fields: drive_link + download_url)  
   âœ… /api/public/checkout/<cid> (keep Stripe TEST mode only)  
   âœ… /api/public/after-payment (already verifies webhook signature)  
   NEW:
   â€¢ /api/public/job-history/<email>  
       â†’ returns last 5 jobs from Job Log filtered by Owner Email  
   â€¢ /api/public/send-email  
       â†’ sends job completion email (using Replitâ€™s built-in sendmail or SMTP relay)  
   â€¢ /api/public/support  
       â†’ logs support requests to Notion Partners DB or Support DB  
   â€¢ /api/public/download/<cid>  
       â†’ returns signed download URL (if file stored in Drive or /tmp)

C. bot/processor.py  
   - On successful job completion, upload output file to Drive if enabled.  
   - Save Drive URL to Job Log field â€œDrive Linkâ€.  
   - Call /send-email automatically if jobâ€™s Owner Email exists.

D. new template: templates/email_job_complete.html  
   â†’ Simple HTML email template: â€œYour EchoPilot job is ready â€” QA: {{qa_score}}%, Duration: {{duration_min}} min, Download: {{download_url}}â€

E. logs/customer_email.log  
   â†’ Log every email send with timestamp, recipient, subject, status.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2ï¸âƒ£  LOGIC / WORKFLOW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Customer uploads audio â†’ creates Notion Automation Queue entry.  
2. Bot processes job â†’ creates Job Log entry with QA + duration.  
3. Stripe payment (webhook test mode) updates Payment Status = Paid.  
4. Processor detects Paid status â†’ uploads output to Drive â†’ emails customer.  
5. Portal polls job status until Paid, then shows â€œDownload Resultsâ€.  
6. Customer can view recent jobs in Job History and contact support.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
3ï¸âƒ£  SECURITY REQUIREMENTS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- Keep STRIPE_SECRET_KEY in test mode only.  
- Never expose API keys in JS.  
- Verify webhook signatures (server-side).  
- Sanitize email inputs (allow only valid RFC addresses).  
- Rate-limit /send-email and /support to max 5 req / min per IP.  
- Continue using DASHBOARD_KEY for internal endpoints only.  

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
4ï¸âƒ£  TEST PROCEDURE (REPLIT AI SHOULD RUN AFTER BUILD)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Upload `sample1.mp3` via portal.  
2. Wait ~60 s for processing.  
3. Click â€œPay Nowâ€ â†’ use Stripe test card 4242 4242 4242 4242.  
4. Confirm Job Log â†’ Payment Status = Paid.  
5. Verify email sent (log entry in customer_email.log).  
6. Verify Download link working (opens signed URL or Drive file).  
7. Refresh â†’ Job History shows new entry.  
8. Test /support form â†’ verify Notion entry created.  

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
5ï¸âƒ£  COMMIT MESSAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
'Phase 26 â€“ Customer Experience & Monetization Layer Added (Email + Download + History + Support)'

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
6ï¸âƒ£  POST-DEPLOY VERIFICATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Open:
   https://echopilotai.replit.app/portal
Confirm:
   - Upload â†’ Process â†’ Pay â†’ Email â†’ Download flow works end-to-end.
   - Logs updated: customer_portal.log, customer_email.log.
   - QA â‰¥ 80 % and gross_usd > $0.50 (test mode checkout OK).