Replit AI Agent ‚Äî EchoPilotAI Full Rebuild, Sync, and Verification (Safe Mode)

Objective:
Ensure every EchoPilotAI phase, update, and enhancement is correctly applied in the current deployment. 
Perform a full clean build, cache-bust, restart, and verification ‚Äî without touching run.py.

Instructions (follow exactly, fail fast on any error):

1) Preconditions
   - Confirm run.py exists.
   - Confirm static/ directory exists or create it.
   - Create logs/ if missing.

2) Identify workspace revision
   - Capture current Git short commit hash if available.
   - Generate UTC timestamp for build.
   - Print both values.

3) Build static site (if marketing-site present)
   - If marketing-site/app exists or marketing-site/next.config.mjs present:
       a) npm ci (or npm install)
       b) npx next build
       c) npx next export
       d) rsync marketing-site/out ‚Üí static/
   - If not present, skip build and log: ‚ÄúNo Next.js app found, using existing static files.‚Äù

4) Version stamping
   - Write JSON manifest to static/version.json:
       {
         "build_utc": "<timestamp>",
         "commit": "<git commit or workspace>"
       }
   - Write BUILD_UTC=<timestamp> and COMMIT=<commit> to static/.buildstamp
   - Write UTC timestamp to static/.cachebuster

5) Safe cleanup
   - Remove any old build directories:
       marketing-site/.next, marketing-site/out, marketing-site/build, marketing-site/public/_next, static/_next
   - Delete stale lock files (*.lock) in project root.
   - Do NOT touch run.py or bot/*.py

6) Restart backend safely
   - Kill any running Gunicorn process.
   - Sleep 2 seconds.
   - Start fresh Gunicorn instance:
       gunicorn -w 1 -k gthread -t 120 --bind 0.0.0.0:$PORT run:app
   - Redirect logs to /tmp/gunicorn.out.

7) Wait for health
   - Poll /health (localhost:$PORT) every second up to 40s.
   - Expect 200 OK.
   - On failure, print last 120 lines of /tmp/gunicorn.out and exit.

8) Verify content and routes
   - Verify each route for presence of key markers:
       / ‚Üí <title>
       /pricing ‚Üí <h1
       /auth/login ‚Üí <form
       /app ‚Üí <html
       /health ‚Üí ‚Äúhealthy‚Äù
   - Optionally check APIs if present:
       /api/support/ticket ‚Üí OPTIONS responds OK
       /api/telemetry/workflows ‚Üí reachable
   - For each route print ‚úì PASS or x FAIL.

9) Print version files
   - Output contents of static/.buildstamp, static/.cachebuster, and static/version.json.

10) Cost monitor (optional)
   - If scripts/cost-monitor.sh exists, run it.
   - If missing, skip gracefully.

11) Output summary
   - Print total PASS/FAIL count.
   - If all checks passed: ‚Äúüéâ ALL CHECKS PASSED.‚Äù
   - Otherwise, list failing routes and exit non-zero.

12) Final confirmation
   - Print: ‚Äú‚úÖ EchoPilotAI verified successfully ‚Äî build applied, healthy, ready for production.‚Äù

Safety rules:
- Do NOT modify run.py or API logic.
- Do NOT delete static/, bot/, or database directories.
- Stop immediately if /health or / route fails.
- Use explicit echo statements for clarity.

Expected outputs:
- ‚úÖ static/version.json, .buildstamp, .cachebuster
- ‚úÖ All key routes return correct HTML or JSON
- ‚úÖ Health endpoint = 200 OK
- ‚úÖ Gunicorn running and stable
- ‚úÖ Cost monitor (if present) reports within budget

End of instructions.