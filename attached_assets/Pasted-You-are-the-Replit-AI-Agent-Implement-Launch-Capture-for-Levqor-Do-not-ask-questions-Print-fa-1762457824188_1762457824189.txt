You are the Replit AI Agent. Implement “Launch & Capture” for Levqor. Do not ask questions. Print failing step and exit non-zero on any error.

GOALS
A) Auth: Supabase email sign-in (Auth.js on Next.js front), backend JWT verification.
B) Launch site: /, /pricing, /signup, /dashboard (usage), /success, /cancel.
C) Referrals: ?ref= code capture, 1-month credit after 2 referred signups.
D) Analytics: Plausible (optional) + basic in-house metrics endpoint.
E) GTM assets: Product Hunt/OpenGraph meta, sitemap/robots.

INPUTS (env; never print secrets)
Frontend (Vercel):
  NEXT_PUBLIC_SUPABASE_URL=...
  NEXT_PUBLIC_SUPABASE_ANON_KEY=...
  NEXT_PUBLIC_BACKEND_BASE=https://<backend-domain>
  NEXT_PUBLIC_PLAUSIBLE_DOMAIN=levqor.ai   # optional
Backend:
  SUPABASE_URL=...
  SUPABASE_SERVICE_ROLE_KEY=...
  JWT_AUDIENCE=supabase
  FRONTEND_URL=https://<frontend-domain>
  BILLING_ENABLED=true

STRUCTURE ASSUMPTIONS
- Frontend: Next.js 14 in levqor/frontend
- Backend: Flask/FastAPI with /billing/* live
- Stripe live configured

TASKS

1) FRONTEND AUTH (Next.js, App Router)
- Add Supabase client:
  levqor/frontend/src/lib/supabase.ts
- Install deps: @supabase/supabase-js, next, react
- Pages:
  - /signup: email magic-link form using supabase.auth.signInWithOtp({ email }).
  - /dashboard: server component that checks Supabase session (RLS via middleware); shows:
    • user email
    • subscription status (fetch from `${NEXT_PUBLIC_BACKEND_BASE}/me/subscription`)
    • usage chart (calls `${NEXT_PUBLIC_BACKEND_BASE}/me/usage`)
  - Middleware to protect /dashboard; redirect to /signup if no session.
- Navbar: Sign up / Dashboard links. Footer: Privacy, Terms, Pricing.

2) FRONTEND REFERRALS
- On first load, read URL params: ref, utm_source, utm_medium, utm_campaign.
- Store JSON in localStorage key levqor_ref with timestamp.
- On successful signup, POST to `${NEXT_PUBLIC_BACKEND_BASE}/referrals/capture` with { ref, email }.

3) FRONTEND ANALYTICS + SEO
- If NEXT_PUBLIC_PLAUSIBLE_DOMAIN is set, inject Plausible script in layout.
- Add OG/Twitter meta, canonical link.
- Ensure /robots.txt and /sitemap.xml exist and include /, /pricing, /signup, /dashboard.

4) BACKEND AUTH GUARD
- Add /auth/verify to accept Supabase JWT (Authorization: Bearer). Verify with SUPABASE_JWKS (fetch from SUPABASE_URL/auth/v1/.well-known/jwks.json) or via supabase-python.
- Add dependency function require_user() returning {user_id,email} or 401.

5) BACKEND USER + SUBSCRIPTION
- Add tables (create if missing): users(id, email, created_at, ref_code), referrals(id, referrer_user_id, referee_email, created_at, credited bool default false), usage_daily(user_id, day, jobs_run int, cost_saving numeric).
- Endpoints:
  - GET /me/subscription → reads Stripe mapping by customer id (existing ledger or create mapping on first checkout); return {plan, status, renews_at}.
  - GET /me/usage → last 14 days from usage_daily; synthesize zeros if none.
  - POST /referrals/capture {ref, email} → store referral intent; do nothing if missing ref.
  - GET /referrals/status → list counts for current user.
  - POST /rewards/credit (internal) → if a user has >=2 completed referees with active subscriptions and not yet credited → grant 1 month credit via Stripe API (coupon or invoice item), set credited=true. Protect with GOVERNANCE_TOKEN.

6) REFERRAL CODE GEN
- On first login: if users.ref_code is null, set ref_code=short base36 of user_id hash.
- Frontend /dashboard shows “Your link: https://<frontend-domain>/?ref=<ref_code>”

7) ANALYTICS (IN-HOUSE BASIC)
- Backend endpoints:
  - POST /events {type, meta} (anonymous; rate limit) → store to metrics/events.jsonl
  - GET /metrics/summary → { signups_7d, conversions_7d, mrr_estimate, arpu_estimate }
- Frontend fires /events for “pageview:/pricing”, “cta_click:checkout”, “signup:start/success”.

8) PRODUCT HUNT PACK
- Add public/producthunt/og.png placeholder.
- Add meta tags to layout: og:title “Levqor — self-driving automation”, og:image, og:description.
- Create docs/LAUNCH_CHECKLIST.md with steps to submit to Product Hunt and add badge later.

9) SECURITY + CORS
- Ensure backend CORS allows frontend domain for /me/* and /referrals/* and /events.

10) VERIFICATION (must pass)
- FRONTEND:
  - GET /signup returns 200; magic link form visible.
  - GET /dashboard redirects to /signup when logged out.
  - After manual test login, /dashboard shows email and usage.
  - /pricing buttons still open Stripe Checkout.
- BACKEND:
  - GET /auth/verify with a valid Supabase token returns 200 user json.
  - GET /me/subscription authed returns JSON with plan/status.
  - POST /referrals/capture with ref+email returns 200.
  - POST /events returns 200; GET /metrics/summary returns JSON.
- REFERRAL:
  - First login creates ref_code.
  - Visiting site with ?ref=<code> results in capture post after signup.
  - POST /rewards/credit (internal) simulates credit after 2 confirmed referees → returns credited:true.
- SEO:
  - /robots.txt and /sitemap.xml return 200 and contain base routes.

11) OUTPUT SUMMARY (print only non-sensitive)
- urls:
  - signup: https://<frontend>/signup
  - dashboard: https://<frontend>/dashboard
  - pricing: https://<frontend>/pricing
- auth: supabase integrated: OK/FAIL
- referrals: capture+credit endpoints: OK/FAIL
- metrics: events+summary: OK/FAIL
- seo: robots+sitemap present: OK/FAIL
- next: “Add Plausible domain env to enable analytics” if not set

SAFETY
- Do not print secrets or JWTs.
- Rate limit /events (basic token bucket in memory).
- Validate emails server-side.
- Fail closed on any missing env; print which variable is missing and stop.